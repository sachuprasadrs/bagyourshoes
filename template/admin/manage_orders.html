{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Orders - Admin Panel</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            background: #f5f5f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .order-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-processing { background: #cce5ff; color: #004085; }
        .status-shipped { background: #d1ecf1; color: #0c5460; }
        .status-delivered { background: #d4edda; color: #155724; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        .status-confirmed { background: #d1f2eb; color: #0c5834; }

        .filter-tabs {
            margin-bottom: 30px;
        }
        .filter-tabs .nav-link {
            border-radius: 25px;
            margin-right: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .filter-tabs .nav-link.active {
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>

{% include 'admin/header.html' %}

<section class="py-5">
    <div class="container-fluid">
        <div class="row mb-4">
            <div class="col-md-12">
                <h2><i class="fas fa-shopping-cart"></i> Manage Orders</h2>
                <p class="text-muted">View and manage all customer orders</p>
            </div>
        </div>

        <!-- Status Filter Tabs -->
        <div class="filter-tabs">
            <ul class="nav nav-pills">
                <li class="nav-item">
                    <a class="nav-link {% if not current_status %}active{% endif %}" href="{% url 'admin_manage_orders' %}">
                        All ({{ status_counts.all }})
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if current_status == 'pending' %}active{% endif %}" href="?status=pending">
                        Pending ({{ status_counts.pending }})
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if current_status == 'confirmed' %}active{% endif %}" href="?status=confirmed">
                        Confirmed ({{ status_counts.confirmed }})
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if current_status == 'processing' %}active{% endif %}" href="?status=processing">
                        Processing ({{ status_counts.processing }})
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if current_status == 'shipped' %}active{% endif %}" href="?status=shipped">
                        Shipped ({{ status_counts.shipped }})
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if current_status == 'delivered' %}active{% endif %}" href="?status=delivered">
                        Delivered ({{ status_counts.delivered }})
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if current_status == 'cancelled' %}active{% endif %}" href="?status=cancelled">
                        Cancelled ({{ status_counts.cancelled }})
                    </a>
                </li>
            </ul>
        </div>

        <!-- Search Bar -->
        <div class="row mb-4">
            <div class="col-md-6">
                <form method="GET" action="">
                    <div class="input-group">
                        <input type="text" name="search" class="form-control" placeholder="Search by Order ID, Customer Name, Email..." value="{{ search_query }}">
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="submit">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Orders List -->
        <div class="row">
            <div class="col-md-12">
                {% if page_obj %}
                    {% for order in page_obj %}
                    <div class="order-card">
                        <div class="row">
                            <div class="col-md-8">
                                <h5><i class="fas fa-receipt"></i> Order #{{ order.pk }}</h5>
                                <p class="mb-1"><strong>Customer:</strong> {{ order.username }}</p>
                                <p class="mb-1"><strong>Email:</strong> {{ order.user.email|default:"johndoe@gmail.com" }}</p>
                                <p class="mb-1"><strong>Date:</strong> {{ order.created_at|date:"d M Y, h:i A"|default:"N/A" }}</p>
                                <p class="mb-1"><strong>Total:</strong> â‚¹{{ order.calculated_total|floatformat:2 }}</p>
                            </div>
                            <div class="col-md-4 text-right">
                                <span class="status-badge status-{{ order.status|lower }}">{{ order.status|upper }}</span>
                                <div class="mt-3">
                                    <a href="{% url 'admin_order_detail' order.pk %}" class="btn btn-sm btn-info">
                                        <i class="fas fa-eye"></i> View Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <!-- Pagination -->
                    {% if page_obj.has_other_pages %}
                    <nav>
                        <ul class="pagination justify-content-center">
                            {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">Previous</a>
                                </li>
                            {% endif %}

                            {% for num in page_obj.paginator.page_range %}
                                <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                                    <a class="page-link" href="?page={{ num }}{% if current_status %}&status={{ current_status }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">{{ num }}</a>
                                </li>
                            {% endfor %}

                            {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">Next</a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}

                {% else %}
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle"></i> No orders found.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
