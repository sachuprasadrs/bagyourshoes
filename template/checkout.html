{% load static %}
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <title>Checkout - BagYourShoe</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
      <link rel="stylesheet" href="{% static 'css/style.css' %}">
      <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
      <link rel="icon" href="{% static 'images/fevicon.png' %}" type="image/gif" />
      <link rel="stylesheet" href="{% static 'css/jquery.mCustomScrollbar.min.css' %}">
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
      <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <style>
         body {
             margin: 0;
             padding: 0;
             background-color: #f8f9fa;
         }

         .header_section {
             margin-top: 0 !important;
             padding-top: 0 !important;
         }

         .navbar-nav .nav-link {
             padding: 0.75rem 1rem !important;
             margin: 0 0.25rem !important;
             border-radius: 4px !important;
             transition: all 0.2s ease !important;
             min-height: 40px !important;
             display: flex !important;
             align-items: center !important;
             text-decoration: none !important;
             position: relative !important;
             z-index: 10 !important;
         }

         .navbar-nav .nav-link:hover {
             background-color: rgba(0,0,0,0.08) !important;
             transform: translateY(-1px) !important;
         }

         .nav-link img {
             pointer-events: none !important;
             transition: transform 0.2s ease !important;
         }

         .checkout-section {
             padding: 50px 0;
             min-height: 70vh;
         }

         .checkout-section h2 {
             text-align: center;
             margin-bottom: 40px;
             color: #212529;
             font-weight: bold;
         }

         .messages {
             max-width: 800px;
             margin: 0 auto 30px;
         }

         .messages .alert {
             position: relative;
             padding: 15px 40px 15px 15px;
             border-radius: 8px;
             margin-bottom: 10px;
         }

         .close-btn {
             position: absolute;
             right: 15px;
             top: 50%;
             transform: translateY(-50%);
             cursor: pointer;
             font-size: 24px;
             color: inherit;
             opacity: 0.7;
         }

         .close-btn:hover {
             opacity: 1;
         }

         .checkout-container {
             max-width: 1200px;
             margin: 0 auto;
             display: grid;
             grid-template-columns: 1fr 1fr;
             gap: 30px;
             padding: 0 15px;
         }

         .order-summary {
             background: white;
             padding: 30px;
             border-radius: 10px;
             box-shadow: 0 2px 15px rgba(0,0,0,0.1);
         }

         .order-summary h3 {
             margin-bottom: 25px;
             color: #212529;
             font-weight: bold;
             border-bottom: 2px solid #f12a47;
             padding-bottom: 10px;
         }

         .order-table {
             width: 100%;
             margin-bottom: 20px;
         }

         .order-table thead {
             background-color: #f8f9fa;
         }

         .order-table th {
             padding: 12px 10px;
             font-weight: 600;
             color: #495057;
             border-bottom: 2px solid #dee2e6;
         }

         .order-table td {
             padding: 15px 10px;
             vertical-align: middle;
             border-bottom: 1px solid #dee2e6;
         }

         .order-table td img {
             width: 50px;
             height: 50px;
             object-fit: cover;
             border-radius: 5px;
             margin-right: 10px;
         }

         .summary-total {
             background-color: #f8f9fa;
             padding: 20px;
             border-radius: 8px;
             margin-top: 20px;
         }

         .summary-total p {
             display: flex;
             justify-content: space-between;
             margin-bottom: 10px;
             font-size: 16px;
         }

         .summary-total p:last-child {
             font-size: 20px;
             color: #f12a47;
             border-top: 2px solid #dee2e6;
             padding-top: 15px;
             margin-top: 10px;
         }

         .checkout-form {
             background: white;
             padding: 30px;
             border-radius: 10px;
             box-shadow: 0 2px 15px rgba(0,0,0,0.1);
         }

         .checkout-form h3 {
             margin-bottom: 25px;
             color: #212529;
             font-weight: bold;
             border-bottom: 2px solid #f12a47;
             padding-bottom: 10px;
         }

         .form-group {
             margin-bottom: 25px;
         }

         .form-group label {
             display: block;
             margin-bottom: 8px;
             font-weight: 600;
             color: #495057;
         }

         .form-group textarea,
         .form-group select {
             width: 100%;
             padding: 12px 15px;
             border: 1px solid #ced4da;
             border-radius: 6px;
             font-size: 14px;
             transition: all 0.3s ease;
         }

         .form-group textarea {
             min-height: 120px;
             resize: vertical;
         }

         .form-group textarea:focus,
         .form-group select:focus {
             outline: none;
             border-color: #f12a47;
             box-shadow: 0 0 0 3px rgba(241, 42, 71, 0.1);
         }

         .proceed-payment-btn {
             width: 100%;
             padding: 15px;
             background: linear-gradient(135deg, #f12a47 0%, #d81a37 100%);
             color: white;
             border: none;
             border-radius: 8px;
             font-size: 18px;
             font-weight: bold;
             cursor: pointer;
             transition: all 0.3s ease;
             box-shadow: 0 4px 15px rgba(241, 42, 71, 0.3);
         }

         .proceed-payment-btn:hover {
             transform: translateY(-2px);
             box-shadow: 0 6px 20px rgba(241, 42, 71, 0.4);
         }

         .proceed-payment-btn:active {
             transform: translateY(0);
         }

         .empty-cart {
             text-align: center;
             padding: 60px 20px;
             background: white;
             border-radius: 10px;
             max-width: 600px;
             margin: 0 auto;
             box-shadow: 0 2px 15px rgba(0,0,0,0.1);
         }

         .empty-cart p {
             font-size: 18px;
             color: #6c757d;
             margin-bottom: 30px;
         }

         .continue-shopping {
             display: inline-block;
             padding: 12px 30px;
             background: #f12a47;
             color: white;
             text-decoration: none;
             border-radius: 6px;
             font-weight: 600;
             transition: all 0.3s ease;
         }

         .continue-shopping:hover {
             background: #d81a37;
             transform: translateY(-2px);
             box-shadow: 0 4px 15px rgba(241, 42, 71, 0.3);
         }

         @media (max-width: 992px) {
             .checkout-container {
                 grid-template-columns: 1fr;
             }
         }

         @media (max-width: 768px) {
             .order-table {
                 font-size: 12px;
             }

             .order-table td img {
                 width: 40px;
                 height: 40px;
             }

             .checkout-section {
                 padding: 30px 0;
             }
         }
      </style>
   </head>
   <body class="main-layout">
      {% include 'header.html' %}

      <section class="checkout-section">
         <div class="container">
            <h2>Checkout</h2>

            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                    <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if cart_items %}
            <div class="checkout-container">
                <div class="order-summary">
                    <h3>Order Summary</h3>
                    <table class="order-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Size</th>
                                <th>Qty</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in cart_items %}
                            <tr>
                                <td>
                                    <img src="{{ item.image_url }}" alt="{{ item.name }}">
                                    {{ item.name }}
                                </td>
                                <td>₹{{ item.price|floatformat:2 }}</td>
                                <td>{{ item.size }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>₹{{ item.subtotal|floatformat:2 }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="summary-total">
                        <p><span>Subtotal:</span> <span>₹{{ total_price|floatformat:2 }}</span></p>
                        <p><span>Shipping:</span> <span>₹0.00</span></p>
                        <p><strong>Total:</strong> <strong>₹{{ total_price|floatformat:2 }}</strong></p>
                    </div>
                </div>

                <div class="checkout-form">
                    <h3>Shipping Information</h3>
                    <form action="{% url 'payment' %}" method="POST" id="checkoutForm">
                        {% csrf_token %}
                        <input type="hidden" name="total_amount" value="{{ total_price|floatformat:2 }}">

                        <div class="form-group">
                            <label for="address">Shipping Address *</label>
                            <textarea
                                id="address"
                                name="address"
                                required
                                placeholder="Enter your complete shipping address including street, city, state, and postal code"
                            >{{ user.address|default:'' }}</textarea>
                        </div>

                        <div class="form-group">
                            <label for="payment_method">Payment Method *</label>
                            <select id="payment_method" name="payment_method" required>
                                <option value="cod" {% if payment_method == 'cod' %}selected{% endif %}>Cash on Delivery (COD)</option>
                                <option value="razorpay" {% if payment_method == 'razorpay' %}selected{% endif %}>Online Payment (Razorpay)</option>
                            </select>
                        </div>

                        <button type="submit" class="proceed-payment-btn">
                            <i class="fa fa-lock"></i> Proceed to Payment
                        </button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="empty-cart">
                <i class="fa fa-shopping-cart" style="font-size: 64px; color: #dee2e6; margin-bottom: 20px;"></i>
                <p>Your cart is empty. Please add items to proceed with checkout.</p>
                <a href="{% url 'indexed' %}" class="continue-shopping">
                    <i class="fa fa-arrow-left"></i> Continue Shopping
                </a>
            </div>
            {% endif %}
         </div>
      </section>

      {% include 'footer.html' %}

      <script src="{% static 'js/jquery.min.js' %}"></script>
      <script src="{% static 'js/popper.min.js' %}"></script>
      <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
      <script src="{% static 'js/jquery-3.0.0.min.js' %}"></script>
      <script src="{% static 'js/plugin.js' %}"></script>
      <script src="{% static 'js/jquery.mCustomScrollbar.concat.min.js' %}"></script>
      <script src="{% static 'js/custom.js' %}"></script>
      <script src="{% static 'js/owl.carousel.js' %}"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>

      <script>
         $(document).ready(function(){
            // Form validation before submit
            $('#checkoutForm').on('submit', function(e) {
                var address = $('#address').val().trim();
                var paymentMethod = $('#payment_method').val();

                if (!address) {
                    e.preventDefault();
                    alert('Please enter your shipping address.');
                    $('#address').focus();
                    return false;
                }

                if (address.length < 10) {
                    e.preventDefault();
                    alert('Please enter a complete shipping address (at least 10 characters).');
                    $('#address').focus();
                    return false;
                }

                if (!paymentMethod) {
                    e.preventDefault();
                    alert('Please select a payment method.');
                    $('#payment_method').focus();
                    return false;
                }

                // Show loading state on button
                $('.proceed-payment-btn').prop('disabled', true).html('<i class="fa fa-spinner fa-spin"></i> Processing...');
            });
         });
      </script>
   </body>
</html>